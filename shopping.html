<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Shopping App</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #388E3C;
            --accent-color: #8BC34A;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --border-color: #ddd;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--light-gray);
            color: var(--text-color);
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        
        .dashboard {
            display: flex;
            margin-bottom: 1rem;
        }
        
        .lists-sidebar {
            flex: 1;
            max-width: 300px;
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-right: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .list-area {
            flex: 3;
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .lists-header, .active-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .shopping-lists {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .shopping-list-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: var(--light-gray);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .shopping-list-item:hover {
            background-color: var(--medium-gray);
        }
        
        .shopping-list-item.active {
            background-color: var(--accent-color);
            color: white;
        }
        
        .list-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .list-actions button {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
        }
        
        .list-actions button:hover {
            color: var(--primary-color);
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        
        .btn-secondary {
            background-color: #FFF;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--light-gray);
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: #f44336;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            min-width: 300px;
            max-width: 500px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        
        .progress-container {
            margin: 1rem 0;
            background-color: var(--light-gray);
            border-radius: 4px;
            height: 8px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        .items-container {
            margin-top: 1rem;
        }
        
        .category {
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .category-header {
            padding: 0.75rem;
            background-color: var(--light-gray);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-header:hover {
            background-color: var(--medium-gray);
        }
        
        .category-items {
            padding: 0.5rem;
        }
        
        .item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .item:last-child {
            border-bottom: none;
        }
        
        .item-checkbox {
            margin-right: 0.75rem;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .item-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #666;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.5rem;
        }
        
        .badge-sale {
            background-color: #ffeb3b;
            color: #333;
        }
        
        .badge-favorite {
            background-color: #ff9800;
            color: white;
        }
        
        .item-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .search-area {
            margin-bottom: 1rem;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.5rem 2.5rem 0.5rem 0.75rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            font-size: 1rem;
        }
        
        .search-icon {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .purchased {
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        
        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem;
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1001;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .notification.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            
            .lists-sidebar {
                max-width: 100%;
                margin-right: 0;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Grocery Shopping App</h1>
    </header>
    
    <div class="container">
        <div class="dashboard">
            <div class="lists-sidebar">
                <div class="lists-header">
                    <h2>My Lists</h2>
                    <button class="btn btn-sm" id="create-list-btn">+ New List</button>
                </div>
                <ul class="shopping-lists" id="shopping-lists">
                    <!-- Shopping lists will be dynamically added here -->
                </ul>
            </div>
            
            <div class="list-area">
                <div class="active-list-header">
                    <div style="display: flex; align-items: center;">
                        <h2 id="active-list-name">Select a list</h2>
                        <div id="total-cost" style="margin-left: 1rem; font-size: 1.2rem; padding: 0.25rem 0.75rem; background-color: var(--light-gray); border-radius: 4px; display: none;">
                            Total: $<span id="total-cost-value">0.00</span>
                        </div>
                    </div>
                    <div id="list-actions" style="display: none;">
                        <button class="btn btn-secondary btn-sm" id="rename-list-btn">Rename</button>
                        <button class="btn btn-secondary btn-sm" id="duplicate-list-btn">Duplicate</button>
                        <button class="btn btn-secondary btn-sm" id="share-list-btn">Share</button>
                        <button class="btn btn-danger btn-sm" id="delete-list-btn">Delete</button>
                    </div>
                </div>
                
                <div id="no-list-selected" style="text-align: center; padding: 2rem 0;">
                    <p>Select a list from the sidebar or create a new one</p>
                </div>
                
                <div id="list-details" style="display: none;">
                    <div class="search-area">
                        <div class="search-box">
                            <input type="text" id="search-items" placeholder="Search items...">
                            <span class="search-icon">🔍</span>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="all-items">All Items</div>
                        <div class="tab" data-tab="on-sale">On Sale</div>
                        <div class="tab" data-tab="favorites">Favorites</div>
                    </div>
                    
                    <div class="tab-content active" id="all-items">
                        <div class="form-group">
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" class="form-control" id="new-item-name" placeholder="Add a new item...">
                                <button class="btn" id="add-item-btn">Add</button>
                            </div>
                        </div>
                        
                        <div class="items-container" id="items-container">
                            <!-- Categories and items will be dynamically added here -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="on-sale">
                        <div class="items-container" id="sale-items-container">
                            <!-- Sale items will be dynamically added here -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="favorites">
                        <div class="items-container" id="favorite-items-container">
                            <!-- Favorite items will be dynamically added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create/Edit List Modal -->
    <div class="modal" id="list-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="list-modal-title">Create New List</h3>
                <button class="btn-close" id="close-list-modal">✕</button>
            </div>
            <div class="form-group">
                <label for="list-name">List Name</label>
                <input type="text" class="form-control" id="list-name" placeholder="e.g., Weekly Groceries">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-list-modal">Cancel</button>
                <button class="btn" id="save-list">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Item Modal -->
    <div class="modal" id="item-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="item-modal-title">Add Item</h3>
                <button class="btn-close" id="close-item-modal">✕</button>
            </div>
            <div class="form-group">
                <label for="item-name">Item Name</label>
                <input type="text" class="form-control" id="item-name" placeholder="e.g., Milk">
            </div>
            <div class="form-group">
                <label for="item-quantity">Quantity</label>
                <input type="text" class="form-control" id="item-quantity" placeholder="e.g., 1 gallon">
            </div>
            <div class="form-group">
                <label for="item-category">Category</label>
                <select class="form-control" id="item-category">
                    <option value="produce">Produce</option>
                    <option value="dairy">Dairy</option>
                    <option value="meat">Meat</option>
                    <option value="bakery">Bakery</option>
                    <option value="frozen">Frozen</option>
                    <option value="pantry">Pantry</option>
                    <option value="beverages">Beverages</option>
                    <option value="household">Household</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="item-notes">Notes</label>
                <textarea class="form-control" id="item-notes" placeholder="e.g., Brand preference, size"></textarea>
            </div>
            <div class="form-group">
                <label for="item-price">Price</label>
                <input type="number" class="form-control" id="item-price" placeholder="e.g., 3.99" step="0.01">
            </div>
            <div class="form-group">
                <div style="display: flex; align-items: center;">
                    <input type="checkbox" id="item-on-sale">
                    <label for="item-on-sale" style="margin-left: 0.5rem; margin-bottom: 0;">On Sale</label>
                </div>
            </div>
            <div class="form-group">
                <div style="display: flex; align-items: center;">
                    <input type="checkbox" id="item-favorite">
                    <label for="item-favorite" style="margin-left: 0.5rem; margin-bottom: 0;">Favorite</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-item-modal">Cancel</button>
                <button class="btn" id="save-item">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Share Modal -->
    <div class="modal" id="share-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Share List</h3>
                <button class="btn-close" id="close-share-modal">✕</button>
            </div>
            <p>Copy the link below to share this list:</p>
            <div class="form-group">
                <input type="text" class="form-control" id="share-link" readonly>
            </div>
            <div class="modal-footer">
                <button class="btn" id="copy-link-btn">Copy Link</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <script>
        // Data Models
        class ShoppingList {
            constructor(id, name) {
                this.id = id;
                this.name = name;
                this.items = [];
                this.dateCreated = new Date();
                this.dateModified = new Date();
            }
            
            addItem(item) {
                this.items.push(item);
                this.dateModified = new Date();
            }
            
            removeItem(itemId) {
                this.items = this.items.filter(item => item.id !== itemId);
                this.dateModified = new Date();
            }
            
            getItems() {
                return this.items;
            }
            
            getItemsByCategory() {
                const categories = {};
                
                this.items.forEach(item => {
                    if (!categories[item.category]) {
                        categories[item.category] = [];
                    }
                    
                    categories[item.category].push(item);
                });
                
                return categories;
            }
            
            getOnSaleItems() {
                return this.items.filter(item => item.onSale);
            }
            
            getFavoriteItems() {
                return this.items.filter(item => item.favorite);
            }
            
            calculateProgress() {
                if (this.items.length === 0) return 0;
                
                const purchased = this.items.filter(item => item.purchased).length;
                return (purchased / this.items.length) * 100;
            }
            
            calculateTotalCost() {
                if (this.items.length === 0) return 0;
                
                let total = 0;
                
                this.items.forEach(item => {
                    if (item.price) {
                        const itemPrice = parseFloat(item.price);
                        if (!isNaN(itemPrice)) {
                            total += itemPrice;
                        }
                    }
                });
                
                return total.toFixed(2);
            }
            
            updateItem(itemId, updatedData) {
                const itemIndex = this.items.findIndex(item => item.id === itemId);
                
                if (itemIndex !== -1) {
                    this.items[itemIndex] = { ...this.items[itemIndex], ...updatedData };
                    this.dateModified = new Date();
                    return true;
                }
                
                return false;
            }
            
            getItemById(itemId) {
                return this.items.find(item => item.id === itemId);
            }
        }
        
        class Item {
            constructor(id, name, category = 'other') {
                this.id = id;
                this.name = name;
                this.category = category;
                this.quantity = '';
                this.notes = '';
                this.price = '';
                this.onSale = false;
                this.favorite = false;
                this.purchased = false;
                this.dateAdded = new Date();
            }
        }
        
        // Storage Utility
        class StorageManager {
            constructor(storageKey = 'grocery_app_data') {
                this.storageKey = storageKey;
                this.data = this.loadData();
            }
            
            loadData() {
                const storedData = localStorage.getItem(this.storageKey);
                
                if (storedData) {
                    try {
                        const parsedData = JSON.parse(storedData);
                        
                        // Convert plain objects to instances of our classes
                        if (parsedData.lists) {
                            parsedData.lists = parsedData.lists.map(list => {
                                const newList = new ShoppingList(list.id, list.name);
                                newList.dateCreated = new Date(list.dateCreated);
                                newList.dateModified = new Date(list.dateModified);
                                
                                if (list.items) {
                                    newList.items = list.items.map(item => {
                                        const newItem = new Item(item.id, item.name, item.category);
                                        newItem.quantity = item.quantity;
                                        newItem.notes = item.notes;
                                        newItem.price = item.price;
                                        newItem.onSale = item.onSale;
                                        newItem.favorite = item.favorite;
                                        newItem.purchased = item.purchased;
                                        newItem.dateAdded = new Date(item.dateAdded);
                                        return newItem;
                                    });
                                }
                                
                                return newList;
                            });
                        } else {
                            parsedData.lists = [];
                        }
                        
                        return parsedData;
                    } catch (error) {
                        console.error('Error parsing stored data:', error);
                        return { lists: [] };
                    }
                }
                
                return { lists: [] };
            }
            
            saveData() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
            }
            
            getLists() {
                return this.data.lists;
            }
            
            getListById(listId) {
                return this.data.lists.find(list => list.id === listId);
            }
            
            createList(name) {
                const newList = new ShoppingList(this.generateId(), name);
                this.data.lists.push(newList);
                this.saveData();
                return newList;
            }
            
            updateList(listId, updatedData) {
                const listIndex = this.data.lists.findIndex(list => list.id === listId);
                
                if (listIndex !== -1) {
                    this.data.lists[listIndex] = { ...this.data.lists[listIndex], ...updatedData };
                    this.data.lists[listIndex].dateModified = new Date();
                    this.saveData();
                    return true;
                }
                
                return false;
            }
            
            deleteList(listId) {
                this.data.lists = this.data.lists.filter(list => list.id !== listId);
                this.saveData();
            }
            
            duplicateList(listId) {
                const sourceList = this.getListById(listId);
                
                if (sourceList) {
                    const newList = new ShoppingList(this.generateId(), `${sourceList.name} (Copy)`);
                    
                    // Clone items
                    sourceList.items.forEach(item => {
                        const newItem = new Item(this.generateId(), item.name, item.category);
                        newItem.quantity = item.quantity;
                        newItem.notes = item.notes;
                        newItem.price = item.price;
                        newItem.onSale = item.onSale;
                        newItem.favorite = item.favorite;
                        // Don't copy purchased status
                        newItem.purchased = false;
                        
                        newList.addItem(newItem);
                    });
                    
                    this.data.lists.push(newList);
                    this.saveData();
                    return newList;
                }
                
                return null;
            }
            
            addItemToList(listId, item) {
                const list = this.getListById(listId);
                
                if (list) {
                    const newItem = new Item(this.generateId(), item.name, item.category);
                    newItem.quantity = item.quantity || '';
                    newItem.notes = item.notes || '';
                    newItem.price = item.price || '';
                    newItem.onSale = item.onSale || false;
                    newItem.favorite = item.favorite || false;
                    
                    list.addItem(newItem);
                    this.saveData();
                    return newItem;
                }
                
                return null;
            }
            
            updateItem(listId, itemId, updatedData) {
                const list = this.getListById(listId);
                
                if (list) {
                    const success = list.updateItem(itemId, updatedData);
                    
                    if (success) {
                        this.saveData();
                        return true;
                    }
                }
                
                return false;
            }
            
            removeItemFromList(listId, itemId) {
                const list = this.getListById(listId);
                
                if (list) {
                    list.removeItem(itemId);
                    this.saveData();
                    return true;
                }
                
                return false;
            }
            
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substring(2);
            }
        }
        
        // UI Controller
        class UIController {
            constructor(storageManager) {
                this.storageManager = storageManager;
                this.activeListId = null;
                
                // DOM Elements
                this.elements = {
                    shoppingLists: document.getElementById('shopping-lists'),
                    createListBtn: document.getElementById('create-list-btn'),
                    listModal: document.getElementById('list-modal'),
                    listModalTitle: document.getElementById('list-modal-title'),
                    listNameInput: document.getElementById('list-name'),
                    saveListBtn: document.getElementById('save-list'),
                    cancelListModalBtn: document.getElementById('cancel-list-modal'),
                    closeListModalBtn: document.getElementById('close-list-modal'),
                    activeListName: document.getElementById('active-list-name'),
                    totalCost: document.getElementById('total-cost'),
                    totalCostValue: document.getElementById('total-cost-value'),
                    listActions: document.getElementById('list-actions'),
                    renameListBtn: document.getElementById('rename-list-btn'),
                    duplicateListBtn: document.getElementById('duplicate-list-btn'),
                    shareListBtn: document.getElementById('share-list-btn'),
                    deleteListBtn: document.getElementById('delete-list-btn'),
                    noListSelected: document.getElementById('no-list-selected'),
                    listDetails: document.getElementById('list-details'),
                    newItemName: document.getElementById('new-item-name'),
                    addItemBtn: document.getElementById('add-item-btn'),
                    itemsContainer: document.getElementById('items-container'),
                    saleItemsContainer: document.getElementById('sale-items-container'),
                    favoriteItemsContainer: document.getElementById('favorite-items-container'),
                    progressBar: document.getElementById('progress-bar'),
                    searchItems: document.getElementById('search-items'),
                    itemModal: document.getElementById('item-modal'),
                    itemModalTitle: document.getElementById('item-modal-title'),
                    itemNameInput: document.getElementById('item-name'),
                    itemQuantityInput: document.getElementById('item-quantity'),
                    itemCategorySelect: document.getElementById('item-category'),
                    itemNotesInput: document.getElementById('item-notes'),
                    itemPriceInput: document.getElementById('item-price'),
                    itemOnSaleCheckbox: document.getElementById('item-on-sale'),
                    itemFavoriteCheckbox: document.getElementById('item-favorite'),
                    saveItemBtn: document.getElementById('save-item'),
                    cancelItemModalBtn: document.getElementById('cancel-item-modal'),
                    closeItemModalBtn: document.getElementById('close-item-modal'),
                    tabs: document.querySelectorAll('.tab'),
                    tabContents: document.querySelectorAll('.tab-content'),
                    shareModal: document.getElementById('share-modal'),
                    shareLink: document.getElementById('share-link'),
                    copyLinkBtn: document.getElementById('copy-link-btn'),
                    closeShareModalBtn: document.getElementById('close-share-modal'),
                    notification: document.getElementById('notification')
                };
                
                this.itemModalMode = 'add';
                this.editingItemId = null;
                
                this.initEventListeners();
                this.renderLists();
            }
            
            initEventListeners() {
                // List creation and management
                this.elements.createListBtn.addEventListener('click', () => this.openListModal('create'));
                this.elements.saveListBtn.addEventListener('click', () => this.saveList());
                this.elements.cancelListModalBtn.addEventListener('click', () => this.closeListModal());
                this.elements.closeListModalBtn.addEventListener('click', () => this.closeListModal());
                
                // List actions
                this.elements.renameListBtn.addEventListener('click', () => this.openListModal('rename'));
                this.elements.duplicateListBtn.addEventListener('click', () => this.duplicateList());
                this.elements.shareListBtn.addEventListener('click', () => this.openShareModal());
                this.elements.deleteListBtn.addEventListener('click', () => this.deleteList());
                
                // Item management
                this.elements.addItemBtn.addEventListener('click', () => this.quickAddItem());
                this.elements.newItemName.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.quickAddItem();
                });
                
                // Item modal
                this.elements.saveItemBtn.addEventListener('click', () => this.saveItem());
                this.elements.cancelItemModalBtn.addEventListener('click', () => this.closeItemModal());
                this.elements.closeItemModalBtn.addEventListener('click', () => this.closeItemModal());
                
                // Search functionality
                this.elements.searchItems.addEventListener('input', () => this.handleSearch());
                
                // Tab switching
                this.elements.tabs.forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
                });
                
                // Share modal
                this.elements.closeShareModalBtn.addEventListener('click', () => this.closeShareModal());
                this.elements.copyLinkBtn.addEventListener('click', () => this.copyShareLink());
            }
            
            renderLists() {
                const lists = this.storageManager.getLists();
                this.elements.shoppingLists.innerHTML = '';
                
                if (lists.length === 0) {
                    const emptyMessage = document.createElement('li');
                    emptyMessage.textContent = 'No lists yet. Create your first list!';
                    emptyMessage.style.padding = '0.75rem';
                    emptyMessage.style.color = '#666';
                    emptyMessage.style.fontStyle = 'italic';
                    this.elements.shoppingLists.appendChild(emptyMessage);
                    return;
                }
                
                lists.forEach(list => {
                    const listItem = document.createElement('li');
                    listItem.className = 'shopping-list-item';
                    if (list.id === this.activeListId) {
                        listItem.classList.add('active');
                    }
                    
                    listItem.innerHTML = `
                        <span>${list.name}</span>
                        <small>${list.items.length} items</small>
                    `;
                    
                    listItem.addEventListener('click', () => this.setActiveList(list.id));
                    
                    this.elements.shoppingLists.appendChild(listItem);
                });
            }
            
            setActiveList(listId) {
                this.activeListId = listId;
                const list = this.storageManager.getListById(listId);
                
                if (list) {
                    this.elements.activeListName.textContent = list.name;
                    this.elements.listActions.style.display = 'block';
                    this.elements.noListSelected.style.display = 'none';
                    this.elements.listDetails.style.display = 'block';
                    
                    // Show total cost
                    this.updateTotalCost();
                    this.elements.totalCost.style.display = 'block';
                    
                    this.renderItems();
                    this.renderSaleItems();
                    this.renderFavoriteItems();
                    this.updateProgressBar();
                    
                    // Reset search
                    this.elements.searchItems.value = '';
                }
                
                this.renderLists();
            }
            
            updateTotalCost() {
                const list = this.storageManager.getListById(this.activeListId);
                
                if (!list) return;
                
                const totalCost = list.calculateTotalCost();
                this.elements.totalCostValue.textContent = totalCost;
            }
            
            renderItems() {
                const list = this.storageManager.getListById(this.activeListId);
                this.elements.itemsContainer.innerHTML = '';
                
                if (!list) return;
                
                const itemsByCategory = list.getItemsByCategory();
                const categories = Object.keys(itemsByCategory).sort();
                
                if (categories.length === 0) {
                    this.elements.itemsContainer.innerHTML = '<p style="text-align: center; color: #666;">No items yet. Add your first item!</p>';
                    return;
                }
                
                categories.forEach(category => {
                    const items = itemsByCategory[category];
                    
                    // Create category container
                    const categoryContainer = document.createElement('div');
                    categoryContainer.className = 'category';
                    
                    // Create category header
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'category-header';
                    
                    // Format category name
                    const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
                    
                    categoryHeader.innerHTML = `
                        <span>${categoryName} (${items.length})</span>
                        <span>↓</span>
                    `;
                    
                    // Toggle category collapse
                    categoryHeader.addEventListener('click', () => {
                        categoryItems.style.display = categoryItems.style.display === 'none' ? 'block' : 'none';
                        categoryHeader.querySelector('span:last-child').textContent = 
                            categoryItems.style.display === 'none' ? '→' : '↓';
                    });
                    
                    // Create category items container
                    const categoryItems = document.createElement('div');
                    categoryItems.className = 'category-items';
                    
                    // Sort items - purchased at the bottom
                    items.sort((a, b) => {
                        if (a.purchased && !b.purchased) return 1;
                        if (!a.purchased && b.purchased) return -1;
                        return 0;
                    });
                    
                    // Add items to category
                    items.forEach(item => {
                        const itemElement = this.createItemElement(item);
                        categoryItems.appendChild(itemElement);
                    });
                    
                    categoryContainer.appendChild(categoryHeader);
                    categoryContainer.appendChild(categoryItems);
                    this.elements.itemsContainer.appendChild(categoryContainer);
                });
            }
            
            renderSaleItems() {
                const list = this.storageManager.getListById(this.activeListId);
                this.elements.saleItemsContainer.innerHTML = '';
                
                if (!list) return;
                
                const saleItems = list.getOnSaleItems();
                
                if (saleItems.length === 0) {
                    this.elements.saleItemsContainer.innerHTML = '<p style="text-align: center; color: #666;">No items marked as on sale.</p>';
                    return;
                }
                
                saleItems.forEach(item => {
                    const itemElement = this.createItemElement(item);
                    this.elements.saleItemsContainer.appendChild(itemElement);
                });
            }
            
            renderFavoriteItems() {
                const list = this.storageManager.getListById(this.activeListId);
                this.elements.favoriteItemsContainer.innerHTML = '';
                
                if (!list) return;
                
                const favoriteItems = list.getFavoriteItems();
                
                if (favoriteItems.length === 0) {
                    this.elements.favoriteItemsContainer.innerHTML = '<p style="text-align: center; color: #666;">No items marked as favorites.</p>';
                    return;
                }
                
                favoriteItems.forEach(item => {
                    const itemElement = this.createItemElement(item);
                    this.elements.favoriteItemsContainer.appendChild(itemElement);
                });
            }
            
            createItemElement(item) {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.dataset.itemId = item.id;
                
                const checkboxId = `item-${item.id}`;
                
                let itemNameClass = '';
                if (item.purchased) {
                    itemNameClass = 'purchased';
                }
                
                let badges = '';
                if (item.onSale) {
                    badges += '<span class="badge badge-sale">On Sale</span>';
                }
                if (item.favorite) {
                    badges += '<span class="badge badge-favorite">Favorite</span>';
                }
                
                itemElement.innerHTML = `
                    <div class="item-checkbox">
                        <input type="checkbox" id="${checkboxId}" ${item.purchased ? 'checked' : ''}>
                    </div>
                    <div class="item-details">
                        <div class="item-name ${itemNameClass}">${item.name} ${badges}</div>
                        <div class="item-meta">
                            ${item.quantity ? `<span>Qty: ${item.quantity}</span>` : ''}
                            ${item.price ? `<span>$${item.price}</span>` : ''}
                        </div>
                        ${item.notes ? `<div class="item-notes">${item.notes}</div>` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn-edit" title="Edit">✏️</button>
                        <button class="btn-delete" title="Delete">🗑️</button>
                    </div>
                `;
                
                // Handle checkbox change
                const checkbox = itemElement.querySelector(`#${checkboxId}`);
                checkbox.addEventListener('change', () => {
                    this.toggleItemPurchased(item.id, checkbox.checked);
                });
                
                // Handle edit button
                const editBtn = itemElement.querySelector('.btn-edit');
                editBtn.addEventListener('click', () => {
                    this.openItemModal('edit', item.id);
                });
                
                // Handle delete button
                const deleteBtn = itemElement.querySelector('.btn-delete');
                deleteBtn.addEventListener('click', () => {
                    this.deleteItem(item.id);
                });
                
                return itemElement;
            }
            
            toggleItemPurchased(itemId, purchased) {
                this.storageManager.updateItem(this.activeListId, itemId, { purchased });
                this.renderItems();
                this.renderSaleItems();
                this.renderFavoriteItems();
                this.updateProgressBar();
                // No need to update total cost as purchase status doesn't affect price
            }
            
            updateProgressBar() {
                const list = this.storageManager.getListById(this.activeListId);
                
                if (!list) return;
                
                const progress = list.calculateProgress();
                this.elements.progressBar.style.width = `${progress}%`;
                
                // Change color based on progress
                let color = 'var(--primary-color)';
                if (progress >= 100) {
                    color = '#4CAF50';
                } else if (progress >= 75) {
                    color = '#8BC34A';
                } else if (progress >= 50) {
                    color = '#FFC107';
                } else if (progress >= 25) {
                    color = '#FF9800';
                }
                
                this.elements.progressBar.style.backgroundColor = color;
            }
            
            openListModal(mode, listId = null) {
                this.elements.listModal.classList.add('active');
                this.elements.listNameInput.focus();
                
                if (mode === 'create') {
                    this.elements.listModalTitle.textContent = 'Create New List';
                    this.elements.listNameInput.value = '';
                    this.listModalMode = 'create';
                } else if (mode === 'rename') {
                    this.elements.listModalTitle.textContent = 'Rename List';
                    const list = this.storageManager.getListById(this.activeListId);
                    this.elements.listNameInput.value = list ? list.name : '';
                    this.listModalMode = 'rename';
                }
            }
            
            closeListModal() {
                this.elements.listModal.classList.remove('active');
            }
            
            saveList() {
                const name = this.elements.listNameInput.value.trim();
                
                if (!name) {
                    this.showNotification('Please enter a list name', 'error');
                    return;
                }
                
                if (this.listModalMode === 'create') {
                    const newList = this.storageManager.createList(name);
                    this.setActiveList(newList.id);
                    this.showNotification('List created successfully');
                } else if (this.listModalMode === 'rename') {
                    this.storageManager.updateList(this.activeListId, { name });
                    this.elements.activeListName.textContent = name;
                    this.renderLists();
                    this.showNotification('List renamed successfully');
                }
                
                this.closeListModal();
            }
            
            duplicateList() {
                const newList = this.storageManager.duplicateList(this.activeListId);
                
                if (newList) {
                    this.setActiveList(newList.id);
                    this.showNotification('List duplicated successfully');
                } else {
                    this.showNotification('Failed to duplicate list', 'error');
                }
            }
            
            deleteList() {
                const confirmed = confirm('Are you sure you want to delete this list? This action cannot be undone.');
                
                if (confirmed) {
                    this.storageManager.deleteList(this.activeListId);
                    
                    // Set active list to first available list or null
                    const lists = this.storageManager.getLists();
                    this.activeListId = lists.length > 0 ? lists[0].id : null;
                    
                    if (this.activeListId) {
                        this.setActiveList(this.activeListId);
                    } else {
                        this.elements.activeListName.textContent = 'Select a list';
                        this.elements.listActions.style.display = 'none';
                        this.elements.noListSelected.style.display = 'block';
                        this.elements.listDetails.style.display = 'none';
                    }
                    
                    this.renderLists();
                    this.showNotification('List deleted successfully');
                }
            }
            
            quickAddItem() {
                const name = this.elements.newItemName.value.trim();
                
                if (!name || !this.activeListId) return;
                
                // Create a basic item, category will be auto-assigned based on common grocery items
                const category = this.guessCategoryFromName(name);
                
                const newItem = this.storageManager.addItemToList(this.activeListId, { 
                    name,
                    category
                });
                
                if (newItem) {
                    this.elements.newItemName.value = '';
                    this.renderItems();
                    this.updateProgressBar();
                    this.updateTotalCost();
                    this.showNotification('Item added successfully');
                }
            }
            
            guessCategoryFromName(name) {
                name = name.toLowerCase();
                
                // Define categories and their common items
                const categoryPatterns = {
                    produce: ['apple', 'banana', 'orange', 'grape', 'lemon', 'lime', 'avocado', 'tomato', 'lettuce', 'spinach', 'kale', 'carrot', 'potato', 'onion', 'garlic', 'broccoli', 'cauliflower', 'cucumber', 'pepper', 'zucchini', 'eggplant', 'berries', 'fruit', 'vegetable'],
                    dairy: ['milk', 'cheese', 'yogurt', 'butter', 'cream', 'sour cream', 'ice cream', 'egg', 'margarine'],
                    meat: ['beef', 'chicken', 'turkey', 'pork', 'ham', 'bacon', 'sausage', 'fish', 'salmon', 'tuna', 'shrimp', 'meat', 'steak', 'ground'],
                    bakery: ['bread', 'bun', 'roll', 'bagel', 'muffin', 'tortilla', 'pita', 'cake', 'cookie', 'pastry', 'croissant', 'donut'],
                    frozen: ['frozen', 'ice', 'pizza', 'nugget', 'fries', 'vegetable blend', 'waffles'],
                    pantry: ['pasta', 'rice', 'cereal', 'soup', 'canned', 'sauce', 'condiment', 'oil', 'vinegar', 'spice', 'herb', 'flour', 'sugar', 'bean', 'nut', 'snack', 'chip', 'pretzel', 'cookie', 'cracker'],
                    beverages: ['water', 'soda', 'juice', 'coffee', 'tea', 'beer', 'wine', 'liquor', 'drink', 'beverage', 'milk'],
                    household: ['paper', 'toilet', 'tissue', 'napkin', 'detergent', 'soap', 'cleaner', 'cleaning', 'trash', 'bag', 'foil', 'wrap', 'battery', 'light bulb']
                };
                
                // Check if name contains any keywords for each category
                for (const [category, keywords] of Object.entries(categoryPatterns)) {
                    for (const keyword of keywords) {
                        if (name.includes(keyword)) {
                            return category;
                        }
                    }
                }
                
                // Default to other if no match found
                return 'other';
            }
            
            openItemModal(mode, itemId = null) {
                this.elements.itemModal.classList.add('active');
                this.itemModalMode = mode;
                
                if (mode === 'add') {
                    this.elements.itemModalTitle.textContent = 'Add Item';
                    this.elements.itemNameInput.value = '';
                    this.elements.itemQuantityInput.value = '';
                    this.elements.itemCategorySelect.value = 'other';
                    this.elements.itemNotesInput.value = '';
                    this.elements.itemPriceInput.value = '';
                    this.elements.itemOnSaleCheckbox.checked = false;
                    this.elements.itemFavoriteCheckbox.checked = false;
                } else if (mode === 'edit') {
                    this.elements.itemModalTitle.textContent = 'Edit Item';
                    
                    const list = this.storageManager.getListById(this.activeListId);
                    const item = list ? list.getItemById(itemId) : null;
                    
                    if (item) {
                        this.elements.itemNameInput.value = item.name;
                        this.elements.itemQuantityInput.value = item.quantity;
                        this.elements.itemCategorySelect.value = item.category;
                        this.elements.itemNotesInput.value = item.notes;
                        this.elements.itemPriceInput.value = item.price;
                        this.elements.itemOnSaleCheckbox.checked = item.onSale;
                        this.elements.itemFavoriteCheckbox.checked = item.favorite;
                        this.editingItemId = itemId;
                    }
                }
                
                this.elements.itemNameInput.focus();
            }
            
            closeItemModal() {
                this.elements.itemModal.classList.remove('active');
            }
            
            saveItem() {
                const name = this.elements.itemNameInput.value.trim();
                
                if (!name) {
                    this.showNotification('Please enter an item name', 'error');
                    return;
                }
                
                const itemData = {
                    name,
                    quantity: this.elements.itemQuantityInput.value.trim(),
                    category: this.elements.itemCategorySelect.value,
                    notes: this.elements.itemNotesInput.value.trim(),
                    price: this.elements.itemPriceInput.value.trim(),
                    onSale: this.elements.itemOnSaleCheckbox.checked,
                    favorite: this.elements.itemFavoriteCheckbox.checked
                };
                
                if (this.itemModalMode === 'add') {
                    this.storageManager.addItemToList(this.activeListId, itemData);
                    this.showNotification('Item added successfully');
                } else if (this.itemModalMode === 'edit') {
                    this.storageManager.updateItem(this.activeListId, this.editingItemId, itemData);
                    this.showNotification('Item updated successfully');
                }
                
                this.closeItemModal();
                this.renderItems();
                this.renderSaleItems();
                this.renderFavoriteItems();
                this.updateTotalCost();
            }
            
            deleteItem(itemId) {
                const confirmed = confirm('Are you sure you want to delete this item?');
                
                if (confirmed) {
                    this.storageManager.removeItemFromList(this.activeListId, itemId);
                    this.renderItems();
                    this.renderSaleItems();
                    this.renderFavoriteItems();
                    this.updateProgressBar();
                    this.updateTotalCost();
                    this.showNotification('Item deleted successfully');
                }
            }
            
            handleSearch() {
                const searchTerm = this.elements.searchItems.value.trim().toLowerCase();
                
                if (!searchTerm) {
                    this.renderItems();
                    return;
                }
                
                const list = this.storageManager.getListById(this.activeListId);
                this.elements.itemsContainer.innerHTML = '';
                
                if (!list) return;
                
                const matchingItems = list.getItems().filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.notes.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm)
                );
                
                if (matchingItems.length === 0) {
                    this.elements.itemsContainer.innerHTML = '<p style="text-align: center; color: #666;">No matching items found.</p>';
                    return;
                }
                
                const searchResultsContainer = document.createElement('div');
                searchResultsContainer.className = 'search-results';
                
                const searchHeader = document.createElement('h3');
                searchHeader.textContent = `Search Results (${matchingItems.length})`;
                searchResultsContainer.appendChild(searchHeader);
                
                matchingItems.forEach(item => {
                    const itemElement = this.createItemElement(item);
                    searchResultsContainer.appendChild(itemElement);
                });
                
                this.elements.itemsContainer.appendChild(searchResultsContainer);
            }
            
            switchTab(tabId) {
                // Update tab buttons
                this.elements.tabs.forEach(tab => {
                    if (tab.dataset.tab === tabId) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // Update tab content
                this.elements.tabContents.forEach(content => {
                    if (content.id === tabId) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            }
            
            openShareModal() {
                this.elements.shareModal.classList.add('active');
                
                // Generate a "fake" share link for the prototype
                // In a real app, this would be a proper API-based share mechanism
                const list = this.storageManager.getListById(this.activeListId);
                const baseUrl = window.location.href.split('?')[0];
                this.elements.shareLink.value = `${baseUrl}?list=${list.id}&share=true`;
                this.elements.shareLink.select();
            }
            
            closeShareModal() {
                this.elements.shareModal.classList.remove('active');
            }
            
            copyShareLink() {
                this.elements.shareLink.select();
                document.execCommand('copy');
                this.showNotification('Link copied to clipboard');
            }
            
            showNotification(message, type = 'success') {
                this.elements.notification.textContent = message;
                this.elements.notification.className = 'notification';
                
                if (type === 'error') {
                    this.elements.notification.style.backgroundColor = '#f44336';
                } else {
                    this.elements.notification.style.backgroundColor = 'var(--primary-color)';
                }
                
                this.elements.notification.classList.add('active');
                
                setTimeout(() => {
                    this.elements.notification.classList.remove('active');
                }, 3000);
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            const storageManager = new StorageManager();
            const ui = new UIController(storageManager);
            
            // Create demo data if no lists exist
            if (storageManager.getLists().length === 0) {
                const weeklyList = storageManager.createList('Weekly Groceries');
                
                // Add some sample items
                const sampleItems = [
                    { name: 'Milk', category: 'dairy', quantity: '1 gallon', price: '3.99', onSale: true },
                    { name: 'Eggs', category: 'dairy', quantity: '1 dozen', price: '2.49' },
                    { name: 'Bread', category: 'bakery', quantity: '1 loaf', price: '2.99' },
                    { name: 'Apples', category: 'produce', quantity: '5', price: '4.50', notes: 'Honeycrisp preferred' },
                    { name: 'Chicken Breast', category: 'meat', quantity: '2 lbs', price: '8.99', onSale: true },
                    { name: 'Pasta', category: 'pantry', quantity: '1 box', price: '1.49' },
                    { name: 'Pasta Sauce', category: 'pantry', quantity: '1 jar', price: '2.99', favorite: true },
                    { name: 'Bananas', category: 'produce', quantity: '1 bunch', price: '1.99' },
                    { name: 'Paper Towels', category: 'household', quantity: '1 pack', price: '6.99', notes: 'The good ones' }
                ];
                
                sampleItems.forEach(item => {
                    storageManager.addItemToList(weeklyList.id, item);
                });
                
                // Create a second list
                const partyList = storageManager.createList('Party Supplies');
                
                const partyItems = [
                    { name: 'Chips', category: 'pantry', quantity: '3 bags', price: '9.99' },
                    { name: 'Soda', category: 'beverages', quantity: '4 liters', price: '5.99' },
                    { name: 'Dip', category: 'dairy', quantity: '2 containers', price: '4.99', favorite: true },
                    { name: 'Plastic Cups', category: 'household', quantity: '1 pack', price: '3.99' },
                    { name: 'Napkins', category: 'household', quantity: '2 packs', price: '2.99' }
                ];
                
                partyItems.forEach(item => {
                    storageManager.addItemToList(partyList.id, item);
                });
                
                // Set active list to the first one
                ui.setActiveList(weeklyList.id);
            } else {
                // If lists exist, set active list to the first one
                const lists = storageManager.getLists();
                if (lists.length > 0) {
                    ui.setActiveList(lists[0].id);
                }
            }
        });
    </script>
</body>
</html>